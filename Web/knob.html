<!DOCTYPE html>
<html lang="en">

    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- <link href="css/style.css" rel="stylesheet"> -->
    </head>
    <style>
        .container {
            max-width: 100%;
            height: fit-content;
            border: 2px solid black;
            padding: 10px;
            display: block;
            overflow: clip;
            align-items: center;
        }
    </style>

    <body>
        <div class="container">

        </div>
        </div>
    </body>
    <script>



        var maxLeft = 0;
        var minLeft = 0;
        var lastvalue = 0;

        function createHSlider(fNode, name, id, max, min, steps) {

            let incontainer = document.createElement("DIV");
            let outslider = document.createElement("DIV");
            let label = document.createElement("P");
            let slider = document.createElement("DIV");
            let node = document.createTextNode("0");

            incontainer.setAttribute("class", "inContainer");
            slider.setAttribute("class", "slider");
            outslider.setAttribute("max", max);
            outslider.setAttribute("min", min);
            outslider.setAttribute("step", steps);
            outslider.setAttribute("id", "" + id);
            //alert(outslider.getAttributeNode("max").value);
            outslider.setAttribute("class", "outslider");
            label.style = "width: 100px;height: 50px;padding: 10px;display: flex;align-items: center;";
            incontainer.style = "width: 400px;height: fit-content;padding: 10px;display: flex;align-items: center;"
            outslider.style = "width: 300px;height: 40px;margin: 0px;border-radius: 8px;border: 2px solid salmon;margin-right:30px;background-color: rgb(231, 218, 210);";
            slider.style = "width: 20px;height: 120%;border-radius: 10px;border:2px solid black;background-color: aquamarine;position: relative;";
            //node.style = "left:10px;";
            label.innerText = name;
            outslider.appendChild(slider);
            outslider.addEventListener("click", sliderHnewpositionchild);
            slider.addEventListener("drag", sliderHnewposition);
            slider.addEventListener("dragend", sliderHnewposition);
            slider.draggable = true;
            incontainer.appendChild(outslider);
            incontainer.appendChild(node);
            fNode.appendChild(label);
            fNode.appendChild(incontainer);
            var slideroffset = (outslider.getBoundingClientRect().height - slider.getBoundingClientRect().height) / 2;
            slider.style.top = slideroffset + 'px';
        }

        var container = document.querySelector(".container");
        createHSlider(container, 'walidis fan', 1234, 1, 0, 1);
        createHSlider(container, 'walidis bulb', 1235, 255, 0, 256);
        createHSlider(container, 'walidis fanSpeed', 1234, 3, 1, 2);

        function map(from, fromLow, fromHigh, toLow, toHigh) {
            let toValue = from;
            let mconst = toHigh - ((toHigh - toLow)/(fromHigh - fromLow))*fromHigh;
            if (from >fromHigh) {
                toValue = fromHigh;
            } 
            else if (from < fromLow) {
                toValue = fromLow;
            }
           
            let value = (((toHigh - toLow)/(fromHigh - fromLow))*toValue) + mconst;
            console.log("mapping from:"+from+" to :"+value);

            return value;

        }

        //************************************************************************************************************************************
        //************************* UI/UX functions********************************************************************************************
        //*************************************************************************************************************************************



        // console.log(window.Date());
        function scaler(value, min, max, steps) {
            let stp = steps - 1;
            let change = (max - min) / (steps);
            let values = Array(steps);
            let midvalues = Array(stp);
            for (let i = 0; i < steps + 1; i++) {
                values[i] = min + i * change;
                //alert(values[i] + "");
            }
            for (let i = 0; i < steps; i++) {
                midvalues[i] = (values[i] + values[i + 1]) / 2;
                //alert(midvalues[i] +'');
            }
            if (value <= min || value <= midvalues[0]) {
                return [min, 0];
            }
            if (value >= max) {
                return [max, steps];
            }
            
            for (let j = 0; j < midvalues.length; j++) {
                 //alert("midvalue = " + midvalues[j]);
                if (value <= midvalues[j] && value > values[j]) {
                    //alert(value+' < '+midvalues[j]);
                    return [values[j], j];
                }
                else if (value > midvalues[j] && value <= values[j + 1] && j < (midvalues.length)) {
                    // alert(value+' > '+midvalues[j+1]);
                    return [values[j + 1], j + 1];
                }
                else if(value > midvalues[j] && value <= values[j + 1] && j==(midvalues.length) ){
                    return [values[j],j];
                }
                else {
                     //alert('value = '+value+', max= '+max +'mid = '+values[j+1]);
                    
                }

            }
            alert('scaler fails..');
            return [0, 0];


        }

        function sliderHnewposition() {
            let outslider = this.parentElement;
            let thenode = outslider.nextSibling;
            let max = outslider.getAttributeNode("max").value;
            let min = outslider.getAttributeNode("min").value;
            let steps = outslider.getAttributeNode("step").value;
            //alert(steps);
            // this.style.top = "" + (lastdragY - 50) + "px";
            let bounds = outslider.getBoundingClientRect();
            console.log(max+':'+min+':'+steps);
            console.log(bounds.x);
            let minLeft = bounds.x;
            let maxLeft = bounds.width + bounds.x;
            lastdragX = event.clientX;
            lastdragY = event.clientY;
            //console.log('bounded:'+maxLeft+'>x>'+minLeft+'.x='+lastdragX);


            let lastvaluen = map(lastdragX, minLeft, maxLeft, 0, bounds.width);
            console.log("result : "+lastvaluen);
            lastvalue = scaler(lastvaluen, 0, bounds.width, steps)[0];
            realValue = scaler(lastvaluen, 0, bounds.width, steps)[1];
            //alert(lastvalue +':'+realValue);
            realValue = Math.floor( map(realValue, 0, steps, min, max));
            //alert(lastdragX +':'+lastvalue);
            thenode.nodeValue = realValue;
            outslider.setAttribute("data",realValue);
            this.style.left = "" + lastvalue- 10 + "px";
            //console.log("X" + lastdragX + "<br>Y" + lastdragY);
            console.log(outslider.getAttributeNode("data").value);
        }
        function sliderHnewpositionchild() {
            let slider = this.firstChild;
            
            //console.log(slider);
            let max = this.getAttributeNode("max").value;
            let min = this.getAttributeNode("min").value;
            let steps = this.getAttributeNode("step").value;
            //alert(steps);
            console.log(max+':'+min+':'+steps);
            let bounds = this.getBoundingClientRect();
            //console.log(bounds);
            console.log(bounds.x);
            let minLeft = bounds.x;
            let maxLeft = bounds.width + bounds.x;
            // this.style.top = "" + (lastdragY - 50) + "px";
            lastdragX = event.clientX;
            lastdragY = event.clientY;
            //console.log('bounded:'+maxLeft+'>x>'+minLeft+'.x='+lastdragX);
            let lastvaluen = map(lastdragX, minLeft, maxLeft, 0, bounds.width);
            console.log("result : "+lastvaluen);
            lastvalue = scaler(lastvaluen, 0, bounds.width, steps)[0];
            realValue = scaler(lastvaluen, 0, bounds.width, steps)[1];
            //alert(lastvalue +':'+realValue);
            realValue = Math.floor( map(realValue, 0, steps, min, max));
            //alert(lastvaluen +':'+realValue);
            this.nextSibling.nodeValue = realValue;
            //console.log(this.nextSibling);
            this.setAttribute("data",realValue);
            slider.style.left = "" + lastvalue - 10 + "px";
            // console.log("X" + lastdragX + "<br>Y" + lastdragY);
            console.log(this.getAttributeNode("data").value);
        }

//************************************************************************************************************************
//***********************************data proccessing & updating**********************************************************
//************************************************************************************************************************

if(w = undefined){
    w = new Worker("/Web/worker.js");
    w.postMessage("hi")
}


    </script>

</html>